// paylyt-platform/backend/src/models/index.js
// This file serves as the entry point for the models in the application.

const Job = require('./Job');
const Invoice = require('./Invoice');
const User = require('./User');
const PaymentLedger = require('./PaymentLedger');
const WalletMapping = require('./WalletMapping');
const ConversionTransaction = require('./ConversionTransaction');

module.exports = {
    Job,
    Invoice,
    User,
    PaymentLedger,
    WalletMapping,
    ConversionTransaction,
};

// paylyt-platform/backend/src/models/Job.js
const { Model, DataTypes } = require('sequelize');
const sequelize = require('../config/database');

class Job extends Model {}

Job.init({
    id: {
        type: DataTypes.INTEGER,
        primaryKey: true,
        autoIncrement: true,
    },
    client_id: {
        type: DataTypes.INTEGER,
        allowNull: false,
    },
    freelancer_id: {
        type: DataTypes.INTEGER,
        allowNull: true,
    },
    amount_fiat: {
        type: DataTypes.DECIMAL(10, 2),
        allowNull: false,
    },
    amount_btc: {
        type: DataTypes.DECIMAL(10, 8),
        allowNull: false,
    },
    status: {
        type: DataTypes.ENUM('open', 'in_progress', 'paid_locked', 'completed', 'released', 'disputed'),
        allowNull: false,
    },
}, {
    sequelize,
    modelName: 'Job',
    tableName: 'jobs',
});

// paylyt-platform/backend/src/models/Invoice.js
const { Model, DataTypes } = require('sequelize');
const sequelize = require('../config/database');

class Invoice extends Model {}

Invoice.init({
    invoice_id: {
        type: DataTypes.STRING,
        primaryKey: true,
    },
    payment_request: {
        type: DataTypes.STRING,
        allowNull: false,
    },
    status: {
        type: DataTypes.ENUM('pending', 'paid', 'failed'),
        allowNull: false,
    },
}, {
    sequelize,
    modelName: 'Invoice',
    tableName: 'invoices',
});

// paylyt-platform/backend/src/models/User.js
const { Model, DataTypes } = require('sequelize');
const sequelize = require('../config/database');

class User extends Model {}

User.init({
    id: {
        type: DataTypes.INTEGER,
        primaryKey: true,
        autoIncrement: true,
    },
    username: {
        type: DataTypes.STRING,
        allowNull: false,
        unique: true,
    },
    email: {
        type: DataTypes.STRING,
        allowNull: false,
        unique: true,
    },
    password: {
        type: DataTypes.STRING,
        allowNull: false,
    },
    role: {
        type: DataTypes.ENUM('client', 'freelancer', 'admin'),
        allowNull: false,
    },
}, {
    sequelize,
    modelName: 'User',
    tableName: 'users',
});

// paylyt-platform/backend/src/models/PaymentLedger.js
const { Model, DataTypes } = require('sequelize');
const sequelize = require('../config/database');

class PaymentLedger extends Model {}

PaymentLedger.init({
    job_id: {
        type: DataTypes.INTEGER,
        allowNull: false,
    },
    invoice_id: {
        type: DataTypes.STRING,
        allowNull: false,
    },
    payment_status: {
        type: DataTypes.ENUM('pending', 'completed', 'failed'),
        allowNull: false,
    },
    lock_timestamp: {
        type: DataTypes.DATE,
        allowNull: true,
    },
    release_timestamp: {
        type: DataTypes.DATE,
        allowNull: true,
    },
    release_tx_id: {
        type: DataTypes.STRING,
        allowNull: true,
    },
}, {
    sequelize,
    modelName: 'PaymentLedger',
    tableName: 'payment_ledgers',
});

// paylyt-platform/backend/src/models/WalletMapping.js
const { Model, DataTypes } = require('sequelize');
const sequelize = require('../config/database');

class WalletMapping extends Model {}

WalletMapping.init({
    user_id: {
        type: DataTypes.INTEGER,
        primaryKey: true,
    },
    bitnob_wallet_id: {
        type: DataTypes.STRING,
        allowNull: false,
    },
    external_address: {
        type: DataTypes.STRING,
        allowNull: true,
    },
}, {
    sequelize,
    modelName: 'WalletMapping',
    tableName: 'wallet_mappings',
});

// paylyt-platform/backend/src/models/ConversionTransaction.js
const { Model, DataTypes } = require('sequelize');
const sequelize = require('../config/database');

class ConversionTransaction extends Model {}

ConversionTransaction.init({
    job_id: {
        type: DataTypes.INTEGER,
        allowNull: false,
    },
    user_id: {
        type: DataTypes.INTEGER,
        allowNull: false,
    },
    amount_btc: {
        type: DataTypes.DECIMAL(10, 8),
        allowNull: false,
    },
    amount_fiat: {
        type: DataTypes.DECIMAL(10, 2),
        allowNull: false,
    },
    rate: {
        type: DataTypes.DECIMAL(10, 4),
        allowNull: false,
    },
    timestamp: {
        type: DataTypes.DATE,
        allowNull: false,
    },
}, {
    sequelize,
    modelName: 'ConversionTransaction',
    tableName: 'conversion_transactions',
});