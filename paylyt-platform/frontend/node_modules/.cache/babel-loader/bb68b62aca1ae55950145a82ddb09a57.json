{"ast":null,"code":"import React,{useState,useEffect}from'react';import Modal from'react-modal';import axios from'axios';import QRCode from'@qrcode/react';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const DepositModal=_ref=>{let{isOpen,onRequestClose,contractId,amount}=_ref;const[invoice,setInvoice]=useState(null);const[paymentStatus,setPaymentStatus]=useState('pending');useEffect(()=>{if(isOpen){const fetchInvoice=async()=>{try{const res=await axios.post('/api/payments/deposit',{contractId,amount_sats:amount});setInvoice(res.data.payment_request);}catch(err){console.error(err);}};fetchInvoice();}},[isOpen,contractId,amount]);useEffect(()=>{if(invoice){const interval=setInterval(async()=>{try{const res=await axios.get(\"/api/payments/invoice/\".concat(invoice.id));if(res.data.status==='paid'){setPaymentStatus('paid');clearInterval(interval);}}catch(err){console.error(err);}},5000);return()=>clearInterval(interval);}},[invoice]);return/*#__PURE__*/_jsxs(Modal,{isOpen:isOpen,onRequestClose:onRequestClose,children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Fund Contract\"}),invoice?/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(QRCode,{value:invoice}),/*#__PURE__*/_jsx(\"p\",{children:/*#__PURE__*/_jsx(\"code\",{children:invoice})}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Status: \",paymentStatus]})]}):/*#__PURE__*/_jsx(\"p\",{children:\"Generating invoice...\"}),/*#__PURE__*/_jsx(\"button\",{onClick:onRequestClose,children:\"Cancel\"})]});};export default DepositModal;","map":{"version":3,"names":["React","useState","useEffect","Modal","axios","QRCode","jsx","_jsx","jsxs","_jsxs","DepositModal","_ref","isOpen","onRequestClose","contractId","amount","invoice","setInvoice","paymentStatus","setPaymentStatus","fetchInvoice","res","post","amount_sats","data","payment_request","err","console","error","interval","setInterval","get","concat","id","status","clearInterval","children","value","onClick"],"sources":["/home/user/Paylyt/paylyt-platform/frontend/src/components/DepositModal.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport Modal from 'react-modal';\nimport axios from 'axios';\nimport QRCode from '@qrcode/react';\n\nconst DepositModal = ({ isOpen, onRequestClose, contractId, amount }) => {\n  const [invoice, setInvoice] = useState(null);\n  const [paymentStatus, setPaymentStatus] = useState('pending');\n\n  useEffect(() => {\n    if (isOpen) {\n      const fetchInvoice = async () => {\n        try {\n          const res = await axios.post('/api/payments/deposit', { \n            contractId, \n            amount_sats: amount \n          });\n          setInvoice(res.data.payment_request);\n        } catch (err) {\n          console.error(err);\n        }\n      };\n      fetchInvoice();\n    }\n  }, [isOpen, contractId, amount]);\n\n  useEffect(() => {\n    if (invoice) {\n      const interval = setInterval(async () => {\n        try {\n          const res = await axios.get(`/api/payments/invoice/${invoice.id}`);\n          if (res.data.status === 'paid') {\n            setPaymentStatus('paid');\n            clearInterval(interval);\n          }\n        } catch (err) {\n          console.error(err);\n        }\n      }, 5000);\n      return () => clearInterval(interval);\n    }\n  }, [invoice]);\n\n  return (\n    <Modal isOpen={isOpen} onRequestClose={onRequestClose}>\n      <h2>Fund Contract</h2>\n      {invoice ? (\n        <div>\n          <QRCode value={invoice} />\n          <p><code>{invoice}</code></p>\n          <p>Status: {paymentStatus}</p>\n        </div>\n      ) : (\n        <p>Generating invoice...</p>\n      )}\n      <button onClick={onRequestClose}>Cancel</button>\n    </Modal>\n  );\n};\n\nexport default DepositModal;\n"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,QAAQ,CAAEC,SAAS,KAAQ,OAAO,CAClD,MAAO,CAAAC,KAAK,KAAM,aAAa,CAC/B,MAAO,CAAAC,KAAK,KAAM,OAAO,CACzB,MAAO,CAAAC,MAAM,KAAM,eAAe,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBAEnC,KAAM,CAAAC,YAAY,CAAGC,IAAA,EAAoD,IAAnD,CAAEC,MAAM,CAAEC,cAAc,CAAEC,UAAU,CAAEC,MAAO,CAAC,CAAAJ,IAAA,CAClE,KAAM,CAACK,OAAO,CAAEC,UAAU,CAAC,CAAGhB,QAAQ,CAAC,IAAI,CAAC,CAC5C,KAAM,CAACiB,aAAa,CAAEC,gBAAgB,CAAC,CAAGlB,QAAQ,CAAC,SAAS,CAAC,CAE7DC,SAAS,CAAC,IAAM,CACd,GAAIU,MAAM,CAAE,CACV,KAAM,CAAAQ,YAAY,CAAG,KAAAA,CAAA,GAAY,CAC/B,GAAI,CACF,KAAM,CAAAC,GAAG,CAAG,KAAM,CAAAjB,KAAK,CAACkB,IAAI,CAAC,uBAAuB,CAAE,CACpDR,UAAU,CACVS,WAAW,CAAER,MACf,CAAC,CAAC,CACFE,UAAU,CAACI,GAAG,CAACG,IAAI,CAACC,eAAe,CAAC,CACtC,CAAE,MAAOC,GAAG,CAAE,CACZC,OAAO,CAACC,KAAK,CAACF,GAAG,CAAC,CACpB,CACF,CAAC,CACDN,YAAY,CAAC,CAAC,CAChB,CACF,CAAC,CAAE,CAACR,MAAM,CAAEE,UAAU,CAAEC,MAAM,CAAC,CAAC,CAEhCb,SAAS,CAAC,IAAM,CACd,GAAIc,OAAO,CAAE,CACX,KAAM,CAAAa,QAAQ,CAAGC,WAAW,CAAC,SAAY,CACvC,GAAI,CACF,KAAM,CAAAT,GAAG,CAAG,KAAM,CAAAjB,KAAK,CAAC2B,GAAG,0BAAAC,MAAA,CAA0BhB,OAAO,CAACiB,EAAE,CAAE,CAAC,CAClE,GAAIZ,GAAG,CAACG,IAAI,CAACU,MAAM,GAAK,MAAM,CAAE,CAC9Bf,gBAAgB,CAAC,MAAM,CAAC,CACxBgB,aAAa,CAACN,QAAQ,CAAC,CACzB,CACF,CAAE,MAAOH,GAAG,CAAE,CACZC,OAAO,CAACC,KAAK,CAACF,GAAG,CAAC,CACpB,CACF,CAAC,CAAE,IAAI,CAAC,CACR,MAAO,IAAMS,aAAa,CAACN,QAAQ,CAAC,CACtC,CACF,CAAC,CAAE,CAACb,OAAO,CAAC,CAAC,CAEb,mBACEP,KAAA,CAACN,KAAK,EAACS,MAAM,CAAEA,MAAO,CAACC,cAAc,CAAEA,cAAe,CAAAuB,QAAA,eACpD7B,IAAA,OAAA6B,QAAA,CAAI,eAAa,CAAI,CAAC,CACrBpB,OAAO,cACNP,KAAA,QAAA2B,QAAA,eACE7B,IAAA,CAACF,MAAM,EAACgC,KAAK,CAAErB,OAAQ,CAAE,CAAC,cAC1BT,IAAA,MAAA6B,QAAA,cAAG7B,IAAA,SAAA6B,QAAA,CAAOpB,OAAO,CAAO,CAAC,CAAG,CAAC,cAC7BP,KAAA,MAAA2B,QAAA,EAAG,UAAQ,CAAClB,aAAa,EAAI,CAAC,EAC3B,CAAC,cAENX,IAAA,MAAA6B,QAAA,CAAG,uBAAqB,CAAG,CAC5B,cACD7B,IAAA,WAAQ+B,OAAO,CAAEzB,cAAe,CAAAuB,QAAA,CAAC,QAAM,CAAQ,CAAC,EAC3C,CAAC,CAEZ,CAAC,CAED,cAAe,CAAA1B,YAAY","ignoreList":[]},"metadata":{},"sourceType":"module"}