{"ast":null,"code":"import React,{useState,useEffect,useContext}from'react';import axios from'axios';import{AuthContext}from'../context/AuthContext';import AddMilestoneModal from'../components/AddMilestoneModal';import DepositModal from'../components/DepositModal';import WithdrawModal from'../components/WithdrawModal';// Import WithdrawModal\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const ContractPage=_ref=>{let{match}=_ref;const[contract,setContract]=useState(null);const[addMilestoneModalIsOpen,setAddMilestoneModalIsOpen]=useState(false);const[depositModalIsOpen,setDepositModalIsOpen]=useState(false);const[withdrawModalIsOpen,setWithdrawModalIsOpen]=useState(false);// State for WithdrawModal\nconst{user}=useContext(AuthContext);useEffect(()=>{const fetchContract=async()=>{try{const res=await axios.get(\"/api/jobs/\".concat(match.params.id));// Corrected endpoint\nsetContract(res.data);}catch(err){console.error(err);}};fetchContract();},[match.params.id]);const openAddMilestoneModal=()=>{setAddMilestoneModalIsOpen(true);};const closeAddMilestoneModal=()=>{setAddMilestoneModalIsOpen(false);};const openDepositModal=()=>{setDepositModalIsOpen(true);};const closeDepositModal=()=>{setDepositModalIsOpen(false);};const openWithdrawModal=()=>{setWithdrawModalIsOpen(true);};const closeWithdrawModal=()=>{setWithdrawModalIsOpen(false);};const handleCompleteJob=async()=>{try{const res=await axios.post(\"/api/jobs/\".concat(contract.id,\"/complete\"));setContract(res.data.job);// Update job status\n}catch(err){console.error(err.response.data);}};const handleApproveJob=async()=>{try{const res=await axios.post(\"/api/jobs/\".concat(contract.id,\"/approve\"));setContract(res.data.job);// Update job status\n}catch(err){console.error(err.response.data);}};if(!contract){return/*#__PURE__*/_jsx(\"div\",{children:\"Loading...\"});}const isClient=user&&user.id===contract.client_id;const isFreelancer=user&&user.id===contract.freelancer_id;return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Contract Details\"}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Job: \",contract.title]}),contract.freelancer&&/*#__PURE__*/_jsxs(\"p\",{children:[\"Freelancer: \",contract.freelancer.name]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Status: \",contract.status]}),contract.escrow&&/*#__PURE__*/_jsxs(\"p\",{children:[\"Escrow Status: \",contract.escrow.status]}),isClient&&contract.status==='in_progress'&&/*#__PURE__*/_jsx(\"button\",{onClick:openDepositModal,children:\"Fund Contract\"}),isFreelancer&&contract.status==='paid_locked'&&/*#__PURE__*/_jsx(\"button\",{onClick:handleCompleteJob,children:\"Complete Job\"}),isClient&&contract.status==='completed'&&/*#__PURE__*/_jsx(\"button\",{onClick:handleApproveJob,children:\"Release Funds\"}),isFreelancer&&contract.status==='released'&&/*#__PURE__*/_jsx(\"button\",{onClick:openWithdrawModal,children:\"Withdraw Funds\"}),/*#__PURE__*/_jsx(\"h3\",{children:\"Milestones\"}),isClient&&/*#__PURE__*/_jsx(\"button\",{onClick:openAddMilestoneModal,children:\"Add Milestone\"}),/*#__PURE__*/_jsx(\"ul\",{children:contract.milestones.map(milestone=>/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(\"p\",{children:milestone.description}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Amount: $\",milestone.amount]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Status: \",milestone.status]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Deadline: \",new Date(milestone.deadline).toLocaleDateString()]})]},milestone.id))}),/*#__PURE__*/_jsx(AddMilestoneModal,{isOpen:addMilestoneModalIsOpen,onRequestClose:closeAddMilestoneModal,contractId:contract.id}),/*#__PURE__*/_jsx(DepositModal,{isOpen:depositModalIsOpen,onRequestClose:closeDepositModal,contractId:contract.id,amount:contract.amount_btc}),/*#__PURE__*/_jsx(WithdrawModal,{isOpen:withdrawModalIsOpen,onRequestClose:closeWithdrawModal,amount:contract.amount_btc})]});};export default ContractPage;","map":{"version":3,"names":["React","useState","useEffect","useContext","axios","AuthContext","AddMilestoneModal","DepositModal","WithdrawModal","jsx","_jsx","jsxs","_jsxs","ContractPage","_ref","match","contract","setContract","addMilestoneModalIsOpen","setAddMilestoneModalIsOpen","depositModalIsOpen","setDepositModalIsOpen","withdrawModalIsOpen","setWithdrawModalIsOpen","user","fetchContract","res","get","concat","params","id","data","err","console","error","openAddMilestoneModal","closeAddMilestoneModal","openDepositModal","closeDepositModal","openWithdrawModal","closeWithdrawModal","handleCompleteJob","post","job","response","handleApproveJob","children","isClient","client_id","isFreelancer","freelancer_id","title","freelancer","name","status","escrow","onClick","milestones","map","milestone","description","amount","Date","deadline","toLocaleDateString","isOpen","onRequestClose","contractId","amount_btc"],"sources":["/home/user/Paylyt/paylyt-platform/frontend/src/pages/ContractPage.js"],"sourcesContent":["import React, { useState, useEffect, useContext } from 'react';\nimport axios from 'axios';\nimport { AuthContext } from '../context/AuthContext';\nimport AddMilestoneModal from '../components/AddMilestoneModal';\nimport DepositModal from '../components/DepositModal';\nimport WithdrawModal from '../components/WithdrawModal'; // Import WithdrawModal\n\nconst ContractPage = ({ match }) => {\n  const [contract, setContract] = useState(null);\n  const [addMilestoneModalIsOpen, setAddMilestoneModalIsOpen] = useState(false);\n  const [depositModalIsOpen, setDepositModalIsOpen] = useState(false);\n  const [withdrawModalIsOpen, setWithdrawModalIsOpen] = useState(false); // State for WithdrawModal\n  const { user } = useContext(AuthContext);\n\n  useEffect(() => {\n    const fetchContract = async () => {\n      try {\n        const res = await axios.get(`/api/jobs/${match.params.id}`); // Corrected endpoint\n        setContract(res.data);\n      } catch (err) {\n        console.error(err);\n      }\n    };\n\n    fetchContract();\n  }, [match.params.id]);\n\n  const openAddMilestoneModal = () => {\n    setAddMilestoneModalIsOpen(true);\n  };\n\n  const closeAddMilestoneModal = () => {\n    setAddMilestoneModalIsOpen(false);\n  };\n\n  const openDepositModal = () => {\n    setDepositModalIsOpen(true);\n  };\n\n  const closeDepositModal = () => {\n    setDepositModalIsOpen(false);\n  };\n\n  const openWithdrawModal = () => {\n    setWithdrawModalIsOpen(true);\n  };\n\n  const closeWithdrawModal = () => {\n    setWithdrawModalIsOpen(false);\n  };\n\n  const handleCompleteJob = async () => {\n    try {\n      const res = await axios.post(`/api/jobs/${contract.id}/complete`);\n      setContract(res.data.job); // Update job status\n    } catch (err) {\n      console.error(err.response.data);\n    }\n  };\n\n  const handleApproveJob = async () => {\n    try {\n      const res = await axios.post(`/api/jobs/${contract.id}/approve`);\n      setContract(res.data.job); // Update job status\n    } catch (err) {\n      console.error(err.response.data);\n    }\n  };\n\n  if (!contract) {\n    return <div>Loading...</div>;\n  }\n\n  const isClient = user && user.id === contract.client_id;\n  const isFreelancer = user && user.id === contract.freelancer_id;\n\n  return (\n    <div>\n      <h2>Contract Details</h2>\n      <p>Job: {contract.title}</p>\n      {contract.freelancer && <p>Freelancer: {contract.freelancer.name}</p>}\n      <p>Status: {contract.status}</p>\n      {contract.escrow && <p>Escrow Status: {contract.escrow.status}</p>}\n\n      {isClient && contract.status === 'in_progress' && (\n        <button onClick={openDepositModal}>Fund Contract</button>\n      )}\n\n      {isFreelancer && contract.status === 'paid_locked' && (\n        <button onClick={handleCompleteJob}>Complete Job</button>\n      )}\n\n      {isClient && contract.status === 'completed' && (\n        <button onClick={handleApproveJob}>Release Funds</button>\n      )}\n\n      {isFreelancer && contract.status === 'released' && (\n        <button onClick={openWithdrawModal}>Withdraw Funds</button>\n      )}\n\n      <h3>Milestones</h3>\n      {isClient && <button onClick={openAddMilestoneModal}>Add Milestone</button>}\n      <ul>\n        {contract.milestones.map((milestone) => (\n          <li key={milestone.id}>\n            <p>{milestone.description}</p>\n            <p>Amount: ${milestone.amount}</p>\n            <p>Status: {milestone.status}</p>\n            <p>Deadline: {new Date(milestone.deadline).toLocaleDateString()}</p>\n          </li>\n        ))}\n      </ul>\n\n      <AddMilestoneModal isOpen={addMilestoneModalIsOpen} onRequestClose={closeAddMilestoneModal} contractId={contract.id} />\n      <DepositModal isOpen={depositModalIsOpen} onRequestClose={closeDepositModal} contractId={contract.id} amount={contract.amount_btc} />\n      <WithdrawModal isOpen={withdrawModalIsOpen} onRequestClose={closeWithdrawModal} amount={contract.amount_btc} />\n    </div>\n  );\n};\n\nexport default ContractPage;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}